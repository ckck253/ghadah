<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ghadah Classroom — Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:"Quicksand",system-ui;margin:0;background:linear-gradient(180deg,#fff0f9,#fff7fb);display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
    .box{width:100%;max-width:460px;background:#fff;border-radius:14px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,0.08)}
    h1{margin:0 0 12px;color:#b02b6b}
    label{font-weight:600;font-size:14px;margin-top:10px;display:block}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #f0c1dc;margin-top:6px}
    .row{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;padding:10px;border-radius:10px;border:0;background:linear-gradient(180deg,#ff66b3,#ff4d9a);color:#fff;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px dashed rgba(255,77,154,0.12);color:#b02b6b}
    .hint{font-size:13px;color:#7b6b7a;margin-top:10px}
    .err{color:#c43;margin-top:8px}
  </style>
</head>
<body>
  <div class="box">
    <h1>Sign in — Ghadah Classroom</h1>

    <label for="email">Email</label>
    <input id="email" type="email" placeholder="ghadah@codingclass.com" />

    <label for="password">Password</label>
    <input id="password" type="password" placeholder="your password" />

    <div class="row">
      <button class="btn" id="signInBtn">Sign in</button>
     
    </div>

    <div style="margin-top:14px;">
      <div class="hint">Create test accounts (optional):</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="regEmail" type="email" placeholder="new email" />
        <input id="regPass" type="password" placeholder="password" />
      </div>
    
    </div>

    <div class="err" id="err"></div>
    <div class="hint" style="margin-top:12px">After sign-in the app will redirect teachers to <strong>admin.html</strong> and students to <strong>student.html</strong>.</div>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const errEl = document.getElementById('err');
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('password');
    const signInBtn = document.getElementById('signInBtn');
    const guestBtn = document.getElementById('guestBtn');

    const regEmail = document.getElementById('regEmail');
    const regPass = document.getElementById('regPass');
    const createBtn = document.getElementById('createBtn');
    const clearReg = document.getElementById('clearReg');

    signInBtn.addEventListener('click', async ()=>{
      errEl.textContent = '';
      const email = emailInput.value.trim();
      const pass = passInput.value;
      if(!email || !pass){ errEl.textContent = 'Email and password required'; return; }
      try{
        await signInWithEmailAndPassword(auth, email, pass);

        // read role doc (document id is the email)
        const roleDocRef = doc(db, "roles", email);
        const snap = await getDoc(roleDocRef);
        const role = snap.exists() && snap.data().role ? snap.data().role : 'student';

        if(role === 'teacher' || role === 'admin'){
          window.location.href = 'admin.html';
        } else {
          window.location.href = 'student.html';
        }
      }catch(e){
        errEl.textContent = e.message;
      }
    });

    guestBtn.addEventListener('click', ()=>{
      // Guest goes to student page; no auth
      window.location.href = 'student.html?guest=1';
    });

    createBtn.addEventListener('click', async ()=>{
      const email = regEmail.value.trim(); const pass = regPass.value;
      if(!email || !pass){ alert('Email & password required'); return; }
      try{
        await createUserWithEmailAndPassword(auth, email, pass);
        // default role document to student
        await setDoc(doc(db, 'roles', email), { role: 'student' });
        alert('Account created and role set to student. You can now sign in.');
        regEmail.value=''; regPass.value='';
      }catch(e){ alert(e.message); }
    });

    clearReg.addEventListener('click', ()=>{ regEmail.value=''; regPass.value=''; });
  </script>
</body>
</html>
